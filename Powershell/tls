# PowerShell script to check and configure TLS 1.2 settings

function Check-TLSConfiguration {
    Param (
        [string]$protocol = "TLS 1.2"
    )

    # Registry paths for TLS 1.2
    $clientPath = "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\$protocol\Client"
    $serverPath = "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\$protocol\Server"

    $results = @()

    # Check Client settings
    if (Test-Path $clientPath) {
        $enabled = Get-ItemProperty -Path $clientPath -Name 'Enabled' -ErrorAction SilentlyContinue
        $disabledByDefault = Get-ItemProperty -Path $clientPath -Name 'DisabledByDefault' -ErrorAction SilentlyContinue

        $results += [PSCustomObject]@{
            Path                       = $clientPath
            Enabled                    = $enabled.Enabled -eq 1
            DisabledByDefault          = $disabledByDefault.DisabledByDefault -eq 0
        }
    } else {
        $results += [PSCustomObject]@{
            Path                       = $clientPath
            Enabled                    = $false
            DisabledByDefault          = $false
        }
    }

    # Check Server settings
    if (Test-Path $serverPath) {
        $enabled = Get-ItemProperty -Path $serverPath -Name 'Enabled' -ErrorAction SilentlyContinue
        $disabledByDefault = Get-ItemProperty -Path $serverPath -Name 'DisabledByDefault' -ErrorAction SilentlyContinue

        $results += [PSCustomObject]@{
            Path                       = $serverPath
            Enabled                    = $enabled.Enabled -eq 1
            DisabledByDefault          = $disabledByDefault.DisabledByDefault -eq 0
        }
    } else {
        $results += [PSCustomObject]@{
            Path                       = $serverPath
            Enabled                    = $false
            DisabledByDefault          = $false
        }
    }

    return $results
}

function Add-TLSConfiguration {
    Param (
        [string]$protocol = "TLS 1.2"
    )

    # Registry paths for TLS 1.2
    $clientPath = "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\$protocol\Client"
    $serverPath = "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\$protocol\Server"

    # Create client path if it doesn't exist
    if (-not (Test-Path $clientPath)) {
        New-Item -Path $clientPath -Force -ErrorAction SilentlyContinue | Out-Null
        Set-ItemProperty -Path $clientPath -Name 'Enabled' -Value 1
        Set-ItemProperty -Path $clientPath -Name 'DisabledByDefault' -Value 0
        Write-Host "Created and configured: $clientPath"
    } else {
        Write-Host "Client configuration already exists: $clientPath"
    }

    # Create server path if it doesn't exist
    if (-not (Test-Path $serverPath)) {
        New-Item -Path $serverPath -Force -ErrorAction SilentlyContinue | Out-Null
        Set-ItemProperty -Path $serverPath -Name 'Enabled' -Value 1
        Set-ItemProperty -Path $serverPath -Name 'DisabledByDefault' -Value 0
        Write-Host "Created and configured: $serverPath"
    } else {
        Write-Host "Server configuration already exists: $serverPath"
    }

    Write-Host "TLS Configuration check complete. Please restart the server to apply changes."
}

# Example usage:
# Check current TLS configuration
$checkResults = Check-TLSConfiguration
$checkResults | Format-Table -AutoSize

# Uncomment the line below to add the TLS configuration if needed
# Add-TLSConfiguration
